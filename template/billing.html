<!DOCTYPE html>
<html lang="en">
<!-- <meta id="ad_id" data-id="{{ads.id|safe}}"> -->
<head>
    <meta charset="UTF-8">
    <title>Billing</title>
</head>
<body>
<table border="3">
<form method="post"> {% csrf_token %}
	<tr><td>Customer Name:</td><td><select name="customer_name" id="customer_name" onchange="myfunct(this)">
		<option>--select--</option>
		{% for c in cust %}
        <option value={{c.cust_id}}>{{c.cust_name}}</option>
		{% endfor %}
	</select><br></td></tr>
	<tr><td>Customer ID:</td><td><input type="text" id="customer_id" name="customer_id"><br></td></tr>
	</table><p></p>
<button type="submit">Generate Bill</button>
</form><br><br>
<form method="post" action="store_bills/{{customer_id}}"> {% csrf_token %}
	<p>CUSTOMER ID: {{customer_id}}</p><br>
<table border="3" id="bill_table" align="center" width="100%">
	<th>Ad ID</th>
	<th>Heading</th>
	<th>From</th>
	<th>Till</th>
	<th>Page No</th>
	<th>Price(tax exclusive)</th>
	<th>GST</th>
	<th>TOTAL</th>
	{% for i in ads %}
	<tr>
		<td>{{i.id}}</td>
		<td>{{i.ad_header}}</td>
		<td>{{i.ad_date_from}}</td>
		<td>{{i.ad_date_till}}</td>
		<td>{{i.ad_page}}</td>
		<td>0</td>
		<td>0</td>
		<td><input type="number" name={{i.id}} onchange="calculate(this)"></td>
	</tr>
	{% endfor %}
</table><br>
<button type="submit">SAVE</button>
</form>
<table align="right" border="0">
	<td><button onclick="grand()"><p align="right" style="padding-right: 5px;font-weight: bold;">CALCULATE GRAND TOTAL:</p></button></td>
	<td><p id="grand_total" align="left" style="padding-right: 20px;font-weight: bold;">0</p></td>
</table>
</body>
</html>

<script>
    function myfunct(obj)
    {
    var id=obj.value;
    document.getElementById('customer_id').value=id;
    }
    function calculate(obj){
    	var price = obj.value/1.18;
    	var gst = obj.value-price;
    	var x = document.getElementById("bill_table").rows[obj.parentNode.parentNode.rowIndex].cells;
    	x[5].innerHTML = price.toFixed(2);
    	x[6].innerHTML = gst.toFixed(2);
    }
    function grand(){
    	var sum = 0;
    	var x = document.getElementById("bill_table").rows;
    	for(var i=1;i<x.length;i++){
    		sum+=(parseFloat(x[i].cells[5].innerHTML)+parseFloat(x[i].cells[6].innerHTML));
    	}
    	x = document.getElementById("grand_total");
    	x.innerHTML = sum;
    }
</script>